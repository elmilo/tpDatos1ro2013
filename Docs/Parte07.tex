\section{Estructuras utilizadas en los archivos}

Como mencionamos en la sección anterior, para guardar toda la información referente a la colección de documentos, utilizaremos 4 archivos.

Combinando los enfoques de \citet{Zhang:2008}, (\citeyear{Zhang:2008}) y de \citet[p.~107]{Buettcher2010}, (\citeyear{Buettcher2010}), llegamos a las estructuras de archivos que describiremos.


\subsection{Los archivos flacos}

Estos archivos solamente almacenan un tipo de dato muy específico:

\begin{itemize}

\item \textbf{*.dic}: aquí se guardan todas los términos que se encontraron en la colección, en forma comprimida con LZW.

\item \textbf{*.frq}: correspondientemente a cada palabra existe una frecuencia absoluta asociada, que se guarda en este archivo. Son enteros sin orden (ascendente o descendente). Se utilizará Rice coding, que es que mejor comprime, para conjuntos de posiciones. Este archivo tiene la finalidad de ayudar a hacer las búsquedas más rápidas, ya que se irá filtrando por la palabra menos frecuente.

\item \textbf{*.ofs}: además se necesita guardar el offset (distancia) que existe para cierto término en el índice invertido. Como son enteros crecientes que se van a cargar en memoria principal, se utilizan deltas. Hay 2 opciones, o se comprime aplicando Rice coding o PFOR-delta, separando en conjuntos de posiciones, o se deja sin comprimir. Analizaremos cuánto espacio se pierde con la última opción.


\begin{figure}[!h]
\centering
    \includegraphics[scale=0.9]{./Images/estructura_2.png}
\caption{Los archivos flacos}
\label{fig:flacos}
\end{figure}



\end{itemize}

\subsection{El índice invertido}

El llamado índice invertido de posiciones sigue con total naturalidad lo propuesto por \cite{Zhang:2008}, pero sin bloques de tamaño de fijo, si no variable (en la frontera de los bytes).

La estructura general de nuestro índice invertido se muestra en la Figura \ref{fig:indice}. Se crean particiones en el archivo llamadas \textit{bloques}, de tamaño variable. 

\begin{figure}[h]
\centering
    \includegraphics[scale=0.9]{./Images/estructura_1.png}
\caption{Estructura del índice invertido}
\label{fig:indice}
\end{figure}


\paragraph{Un bloque}

\begin{itemize}
\item Guarda información correspondiente a un término de la colección.

\item Posee un gran número de listas invertidas correspondientes a las posiciones del término en consideración. Definimos un <<posteo>> como el conjunto de un docID, frecuencia relativa y lista de posiciones. Siguiendo con la referencia, dividimos las listas invertidas en fragmentos con 128 posteos cada una. Este número podría cambiar para hacer más rápida la búsqueda en colecciones chicas o más grandes, pero siempre será múltiplo de 32.

\item Contendrá metadatos (datos adicionales) con información de cuántos fragmentos posee y dónde comienzan (offset desde el primer fragmento), y a continuación los fragmentos. Esto se hace porque, como la estructura de datos permite decodificar los docIDs primero que lo demás, se quiere ser capaz de saltar al siguiente fragmento sin pasar por todos los datos comprimidos. Utilizando PFOR-Delta los datos de cantidad y el docID más grande se guardan (indirectamente), utilizando Rice coding habría que almacenarlos.
\end{itemize}

\subparagraph{Un fragmento}

\begin{itemize}

\item Contiene 128 posteos, almacenados como 128 docIDs, luego 128 frecuencias relativas correspondientes y al final 128 listas de ocurrencias.

\item Unidad básica para descomprimir datos en el índice invertido. Cada uno se puede descomprimir muy rápidamente.

\item Se lo puede <<saltar>> si el docID que buscamos no se encuentra.

\end{itemize}

